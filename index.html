<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ophthalmic Infographic Creator</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="style.css">
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Control Panel -->
        <aside class="sidebar">
            <div class="brand">
                <span class="material-symbols-rounded icon">visibility</span>
                <h1>Ophthalmic<br>Infograph</h1>
            </div>

            <div class="control-group">
                <label for="api-key">Gemini API Key</label>
                <div class="input-wrapper">
                    <span class="material-symbols-rounded input-icon">key</span>
                    <input type="password" id="api-key" placeholder="Enter your key here">
                </div>
                <small class="hint">Your key is not stored permanently.</small>
            </div>

            <div class="control-group">
                <label for="topic-input">Topic or Text</label>
                <textarea id="topic-input"
                    placeholder="Paste your text or describe an ophthalmic topic (e.g., 'Glaucoma management guidelines')..."></textarea>
            </div>

            <button id="generate-btn" class="primary-btn">
                Generate Infographic
            </button>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="top-controls">
                <div class="action-group" id="context-actions">
                    <button class="icon-btn" id="print-btn" title="Print Poster (A4)">
                        <span class="material-symbols-rounded">print</span>
                    </button>
                    <button class="icon-btn" id="poster-btn" title="Toggle Landscape Poster">
                        <span class="material-symbols-rounded">panorama</span>
                    </button>
                    <button class="icon-btn" id="save-btn" title="Save to Knowledge Base">
                        <span class="material-symbols-rounded">bookmark_add</span>
                    </button>
                    <button class="icon-btn" id="download-pdf-btn" title="Download PDF" style="display: none;">
                        <span class="material-symbols-rounded">download</span>
                    </button>
                </div>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
                <div class="action-group" id="global-actions">
                    <button class="icon-btn" id="home-btn" title="Home / Reset">
                        <span class="material-symbols-rounded">home</span>
                    </button>
                    <button class="icon-btn" id="sync-btn" title="Sync with Server">
                        <span class="material-symbols-rounded">sync</span>
                    </button>
                    <button class="icon-btn" id="ftp-btn" title="FTP Server Settings">
                        <span class="material-symbols-rounded">cloud_sync</span>
                    </button>
                    <button class="icon-btn" id="library-btn" title="Open Knowledge Base">
                        <span class="material-symbols-rounded">inventory_2</span>
                    </button>
                </div>
            </div>

            <div id="output-container" class="output-wrapper empty-state">
                <div class="empty-icon-container">
                    <span class="material-symbols-rounded">auto_awesome</span>
                </div>
                <div class="empty-message">
                    <h2>Design Your Infographic</h2>
                    <p>Enter an ophthalmic topic (e.g., "Diabetic Retinopathy Stages") or paste text to generate a
                        professional visual summary.</p>
                    <button id="library-btn-empty" class="btn-text-icon" style="margin-top: 1.5rem;">
                        <span class="material-symbols-rounded">inventory_2</span>
                        Open Library
                    </button>
                </div>
                <!-- Infographic content will be injected here -->
            </div>

            <!-- Hidden container for Text Report Printing -->
            <div id="text-report-container" class="text-report-wrapper" style="display: none;"></div>
        </main>
    </div>

    <!-- Library Modal -->
    <div id="library-modal" class="modal-overlay">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Knowledge Base <span id="library-count-badge" class="count-badge" style="display: none;">0</span>
                </h2>
                <div style="display: flex; gap: 8px;">
                    <button id="import-server-btn" class="icon-btn-ghost" title="Import from Server">
                        <span class="material-symbols-rounded">cloud_download</span>
                    </button>
                    <button id="export-server-btn" class="icon-btn-ghost" title="Export Selected to Server (Upload)"
                        style="display: none;">
                        <span class="material-symbols-rounded">cloud_upload</span>
                    </button>
                    <button id="close-modal-btn" class="icon-btn-ghost">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div id="saved-items-list" class="saved-list">
                    <!-- Items will be injected here -->
                </div>
                <div id="empty-library-msg" class="empty-state-small">
                    <span class="material-symbols-rounded">folder_off</span>
                    <p>No saved infographics yet.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- FTP Server Modal -->
    <div id="ftp-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <span class="material-symbols-rounded"
                        style="vertical-align: middle; margin-right: 8px;">cloud_sync</span>
                    FTP Server Settings
                </h2>
                <button id="close-ftp-modal-btn" class="icon-btn-ghost">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body ftp-modal-body">
                <div id="ftp-status" class="ftp-status-container">
                    <div class="ftp-status-badge stopped">
                        <span class="material-symbols-rounded">cloud_off</span>
                        Not Running
                    </div>
                    <p class="ftp-info">Start the FTP server to allow remote users to access the knowledge base.</p>
                </div>
                <div class="ftp-controls">
                    <button id="start-ftp-btn" class="btn-primary">
                        <span class="material-symbols-rounded">play_arrow</span>
                        Start FTP Server
                    </button>
                    <button id="stop-ftp-btn" class="btn-secondary">
                        <span class="material-symbols-rounded">stop</span>
                        Stop Server
                    </button>
                </div>
                <div class="ftp-instructions">
                    <h4>How to Connect</h4>
                    <ol>
                        <li>Start the Node.js backend server: <code>node server.js</code></li>
                        <li>Click "Start FTP Server" above</li>
                        <li>Use any FTP client (FileZilla, Cyberduck, etc.)</li>
                        <li>Connect to the provided address with credentials</li>
                        <li>Access and download saved infographics remotely</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script type="module" src="script.js"></script>
</body>

</html>